---
title: WuLiang
author: AUV with ability to patrol automatically
layout: post
order: 1
---
<!-- Text stuff -->
<h2>简介</h2>
<p>
	&emsp;	&#8195;无量号自主航行器是一款具备自动巡检、识别、清理等一系列功能的AUV,该项目的目标是制作一台能够对水下管道进行自主清洁的航行器,节约相关人力资源,
	我们在开发过程中加入了许多额外的功能来使其具备更高的可拓展性以及更广泛的应用价值,比如,通过单目摄像头的识别来使其可以对不同类型垃圾进行分类，
	并且通过起背部指示灯来显示类别,通过在底部留出机器臂接口方便之后安装机器臂开展完成更多的水下任务,并且具备可在遥控控制及自主航行两个模式之间灵活切换的优点
	<br /> &emsp;	&#8195;该项目从机械层面的外壳、密封到硬件方面的底层
	电路板的设计、底层控制,再到软件方面的识别与上层控制均为原创,相关资料借鉴或其他各种用途请邮件联系。
</p>
	<hr />

	<!-- Image -->
	<h2>项目图片</h2>

	<div class="row">
    <div class="4u 12u$(mobile)">
      <div class="item">
        <a href="#" class="image fit"><img src="{{ 'assets/images/WuLiang.jpg' | relative_url }}" alt="PicofWuLiang" /></a>
        <header>
          <h3>工作照片</h3>
        </header>
      </div>
      <div class="item">
        <a href="#" class="image fit"><img src="{{ 'assets/images/WuLiangDown.jpg' | relative_url }}" alt="Rhoncus Semper" /></a>
        <header>
          <h3>实物俯视图</h3>
        </header>
      </div>
    </div>
	
    <div class="4u 12u$(mobile)">
		 
      <div class="item">
        <a href="#" class="image fit"><img src="{{ 'assets/images/WuLiangUnder.png' | relative_url }}" alt="Magna Nullam" /></a>
        <header>
          <h3>潜航图</h3>
        </header>
		
      </div>
      <div class="item">
        <a href="#" class="image fit"><img src="{{ 'assets/images/WuLiangrespi.png' | relative_url }}" alt="Natoque Vitae" /></a>
        <header>
          <h3>树莓派接收图像</h3>
        </header>
      </div>
    </div>

    <div class="4u$ 12u$(mobile)">
      <div class="item">
        <a href="#" class="image fit"><img src="{{ 'assets/images/WuLiangLight.png' | relative_url }}" alt="Dolor Penatibus" /></a>
        <header>
          <h3>可调节灯光</h3>
        </header>
      </div>
      <div class="item">
        <a href="#" class="image fit"><img src="{{ 'assets/images/WuLiangRgn.png' | relative_url }}" alt="Orci Convallis" /></a>
        <header>
          <h3>垃圾识别(绿色指示灯)</h3>
        </header>
      </div>
    </div>
  </div>
	<hr />
	
	<!-- protrait -->
	<h2>项目特点</h2>

	<div class="row">
			
			<ul>
				<li>AUV&ROV一体,可自由切换</li>
				<li>双摄像头观测,具备视觉及识别能力</li>
				<li>可对管道污物进行自主清洁</li>
				<li>全方向移动,能够完成潜航、自转、定深、穿门等一系列水下动作</li>
				<li>硬件舱可单独拆卸，方便搭配不同的动力布局。</li>

			</ul>

	</div>		
	<hr />

	<!--  details -->
	<h2>各部分详细资料</h2>

	<h3>A.机械部分</h3>

	<h4>1.框架设计 </h4>
	<p><span class="image left"><img src="{{ 'assets/images/WuLiangKJ.png' | relative_url }}" alt="" /></span>
		&emsp;	&#8195;使用开放式架构,使得航行器开发和布局更加灵活;材料为HDPE,保证了结构的强度,密封舱材料使用亚克力,导轨材料使用铝合金,可搭载机械臂以及其他执行机构,
		通过导轨可以改变它的位置,上图为其框架示意图。
	</p>
	<h4>2.动力布局 </h4>
	<p><span class="image right"><img src="{{ 'assets/images/WuLiangPJ.png' | relative_url }}" alt="" /></span>
		&emsp;	&#8195;采用ROV经典八推布局,上方四个螺旋桨调整姿态完成上浮下潜,下方四个螺旋桨互相配合实现全方向移动。在布局时,考虑了螺旋桨吃水能力,
		使得在水面上时螺旋桨低于水面,能够有效吃水。下方四个螺旋桨轴向正对板材进行挖孔,保证有效吃水推进,上图为其布局示意图。
	</p>
	<h4>3.密封方式 </h4>
	<p>
		&emsp;	&#8195;舱体使用经典O型圈进行水密处理,硬件舱的外部通线使用水密接插件,因此可以独立将硬件舱拆卸下来,使用一个硬件舱应对不同的ROV布局。
	</p>
	<h4>4.清除装置 </h4>
	<p><span class="image right"><img src="{{ 'assets/images/WuLiangQC.png' | relative_url }}" alt="" /></span>
		设计思路: <br /> 
		&emsp;	&#8195;吸附物附着在管道外壁,管道外壁形状较为固定。所以我们安装吸附物吸附的特点和管道的特点,以提高去除和回收效率为目的设计了如右图所示的去除回收机构。<br />
        原理说明: <br /> 
		&emsp;	&#8195;潜航器巡检过程中让回收装置离开管道壁,在检测到吸附物后立即下潜使吸回收装置与管道贴合,然后潜航器前进使得吸附物被刮除,完成任务后再次使刮取装置离开管道。
		去除结束后吸附物被直接被连接在后方的网兜（图中未显示）捕获。
	</p>

	<h3>B.硬件部分</h3>

	<h4>0.硬件流程图 </h4>
	<p><span class="image left"><img src="{{ 'assets/images/WuLiangLCT.png' | relative_url }}" alt="" /></span>
		&emsp;	&#8195;上图是整个硬件系统的流程图,整个系统可以大致分为四个部分:供电系统,下位机及上位机,传感器,通信模块
	</p>
	<h4>1.供电系统</h4>
	<p><span class="image left"><img src="{{ 'assets/images/WuLiangGDB.png' | relative_url }}" alt="" /></span>
		&emsp;	&#8195;航行器采用一块2S电池与一块4S电池供电。4S电池用于为螺旋桨、照明灯、继电器供电,通过继电器控制2S电源的通断,从而控制控制电源的供电;
		2S电池通过多路稳压模块输出5V电压,为树莓派、STM32以其他传感器供电,每路输出最大电流可达到3A。另外设计有四路MOS开关电路,实现5V的可控电压输出。
		当前用于驱动四路信号灯，用于指示潜航器工作状态,图为该航行器上自主设计的一块供电变压电路板
	</p>
	<h4>2.下位机及上位机</h4>
	<p>
		&emsp;	&#8195;下位机采用STM32F103ZET6,该芯片使用高性能的ARM®Cortex-M3,32位的RISC内核,工作频率为72MHz,可以达到同时和上位机、舵机、电机以及其他芯片通信。
		该主控芯片的性能强大，资源丰富，完全满足本项目的需求，同时给日后项目的升级留下了很大的空间。<br />
		&emsp;	&#8195;本项目主要使用了STM32 的串口、IIC接口、定时器PWM输出等功能,作为下位机,STM32 负责接受指令与执行操作。<br />
		&emsp;	&#8195;上位机使用树莓派4B,它是一款基于ARM的微型电脑主板,以MicroSD卡为内存硬盘,卡片主板周围有4个USB接口和一个100以太网接口,
		同时拥有HDMI高清视频输出接口,以上部件全部整合在一张仅比信用卡稍大的主板上。由于体积较小、性能足够,适合放置在ROV 密封舱中。
	</p>
	<h4>3.传感器模块</h4>
	<p>
		&emsp;	&#8195;采用MPU6050作为姿态传感器、MS5837作为深度传感器,满足基本水下航行需求。<br />
		&emsp;	&#8195;MPU-6050为全球首例整合性6轴运动处理组件,相较于多组件方案,免除了组合陀螺仪与加速器时间轴之差的问题,
		减少了大量的封装空间。当连接到三轴磁强计时,MPU-6050提供完整的9轴运动融合输出到其主I2C接口。<br />
		&emsp;	&#8195;MS5837-30BA压力传感器是高精度水深测量的理想选择,水深测量分辨率高达2mm。MS5837-30BA压力传感器模块包括高线性度的压力传
		感元件和超低功耗的24位ΔΣADC,内置工厂校准系数。
	</p>
	<h4>4.通信模块</h4>
	<p>
		&emsp;	&#8195;由于无线信号在水下迅速衰减,为保证可靠性,潜航器采用有线通讯。通讯模块采用电力载波模块,采用Atheros主芯片设计。
		具有集成度高、体积小、发热低等特点。能够提供高达200Mbps的电力线传输速率,工作稳定,性能可靠。
		电力载波模块向用户提供电源接口、工作状态指示接口和网络接口。
	</p>

	<h3>C.软件部分</h3>
	<h4>1.下位机程序设计</h4>
	<p><span class="image left"><img src="{{ 'assets/images/WuLiangPID.png' | relative_url }}" alt="" /></span>
		&emsp;	&#8195;下位机STM32采用自主设计的控制算法,对8个螺旋桨的运动状态进行封装。同时驱动姿态传感器和深度传感器进行数据融合,将欧
		拉角和深度数据作为PID控制器的输入量。<br />
		&emsp;	&#8195;基于螺旋桨运动状态的封装程序,下位机提供了一套通用的通信协议格式,使用串口进行通讯。
		上位机提供动作指令和执行速度,下位机即可做出响应。<br />
		&emsp;	&#8195;对于姿态的计算,主要使用四元数解算和卡尔曼滤波方式。解算过程如下：
	</p>
	<div class="row">	
		<ol>
			<li>将加速度计的三维向量转换为单位向量。归一化只是改变这三个向量的长度,方向不改变,也就是只改变了相同的倍数。</li>
			<li>四元数换成方向余弦中的第三行的三个元素。将当前姿态重力在三个轴的分量分离出来,把四元数换算成方向余弦中的第三行的三个元素(vx,vy,vz)。</li>
			<li>向量叉积得出姿态误差。将ax,ay,az和vx,vy,vz对应的进行向量叉积分别得出ex,ey,ez。将误差积分以消除误差。</li>
			<li>卡尔曼滤波。陀螺仪测的值不断的进行更,相应的积分误差也不断的修正,最后将积分误差反馈给陀螺仪,修正陀螺仪的值。</li>
			<li>求解四元数微分方程，将四元数归一化。</li>
			<li>将四元数转换为欧拉角。</li>
		</ol>
	</div>
	<h4>2.上位机程序设计</h4>
	<p>
		&emsp;	&#8195;上位机程序分为两大模块:自动模式、手动模式。两个模块使用一套通讯接口，使用遥控器可实现两种工作模式的切换。<br />
		&emsp;	&#8195;在手动模式下,上位机接收来自遥控器经过电脑发送的UDP报文,解析报文指令并直接转发给下位机执行。<br />
		&emsp;	&#8195;在自动模式下,上位机无视除模式切换的其他指令,执行预先编写好的策略。<br />
		自动模式下,程序分为图像读取与预处理、巡线处理、物体识别、运动策略。为方便调试,集成了数据可视化功能。<br />
		&emsp;	&#8195;涉及图像处理算法如下:
	</p>
	<div class="row">	
		<ul>
			<li>图像裁剪:通过设定图像ROI区域,拷贝图像获得裁剪图像。</li>
			<li>形态学滤波:对二值化图像进行腐蚀,去除噪点,然后对图像进行膨胀,弥补对管道线的腐蚀。</li>
			<li>二值化:先变化为灰度图,然后设定阈值直接变成二值化图像。</li>
			<li>霍夫变换:通过一种投票算法检测具有特定形状的物体。该过程在一个参数空间中通过计算累计结果的局部最大值得到一个符合该特定形状的集合作为霍夫变换结果。
				经典霍夫变换用来检测图像中的直线,后来霍夫变换扩展到任意形状物体的识别,多为圆和椭圆。</li>
		</ul>
	</div>
	<hr />